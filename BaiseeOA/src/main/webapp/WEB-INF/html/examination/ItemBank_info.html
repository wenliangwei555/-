<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head th:include="commonTemplate :: header">
</head>
<body class="bgcolor-body">
	<div id="page">
		<div th:include="commonTemplate :: headerDiv"></div>
		<div id="content" class="layout">
			<div class="grid-s5m0">
				<div class="col-main">
					<div class="main-wrap">
						<div class="skin-box">
							<div class="skin-box-bd">
								<div class="cur-position">
									<span><a href="javascript:void(0)">考试信息管理</a> </span> <span>&gt;</span>
									<span><a href="javascript:void(0);">试题管理</a> </span> <span>&gt;</span>
									<span><a href="javascript:void(0)">新增试题信息</a></span>
								</div>
								<!-- ==================================== 页面内容开始 ============================= -->
								<div class="cont-box">
									<div class="JsW skin-box-bd" data-widget-type="tab"
										data-widget-config="{'activeIndex':0}">
										<div class="skin-bd-box">
											<div class="list-table">
												<div class="list-table-cont">
													<div class="table6">
														<form id="ClaForm" th:action="@{itemBank/saveitemBank.ht}"
															method="post" th:object="${itemBank}">
															<input type="hidden" name="iId" id="iId" th:value="*{iId}" />
															<input type="hidden" name="promptInformation" id="promptInformation"/>
															<table>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red">*</span><span>试题类型：</span>
																			</div>
																			<div class="td2">
																				<div class="control-css3select css3select-icon-hide">
																					<select class="radius3" id="did"
																						name="did">
																						<option value=""> &nbsp;&nbsp;&nbsp;- - - - - 选择类型 - - - - - </option>
																						<option th:each="info:${course}"
																							th:value="${info.ciId}"
																							th:text="${info.courseTtitle}"></option>
																					</select> 
																				</div>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red">*</span><span>题目：</span>
																			</div>
																			<div class="td2">
																				<span><textarea rows="5" cols="100" id="subject"
																					name="subject" th:text="${itemBank.subject}"></textarea>
																				</span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red">*</span><span>选择一（A）：</span>
																			</div>
																			<div class="td2">
																				<span><input type="text"
																					class="radius3 input" id="selectOne"
																					name="selectOne" th:value="*{selectOne}"/></span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red">*</span><span>选择二（B）：</span>
																			</div>
																			<div class="td2">
																				<span><input type="text"
																					class="radius3 input" id="selectTwo"
																					name="selectTwo" th:value="*{selectTwo}"/></span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red"></span><span>选择三（C）：</span>
																			</div>
																			<div class="td2">
																				<span><input type="text"
																					class="radius3 input" id="selectThree"
																					name="selectThree" th:value="*{selectThree}"/></span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red"></span><span>选择四（D）：</span>
																			</div>
																			<div class="td2">
																				<span><input type="text"
																					class="radius3 input" id="selectFour"
																					name="selectFour" th:value="*{selectFour}" onkeyup="selectFour()"/></span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red">*</span><span>答案(A、B···)：</span>
																			</div>
																			<div class="td2">
																				<span><input type="text"
																					class="radius3 input" id="answer"
																					name="answer" th:value="*{answer}"/></span>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td>
																		<div class="left">
																			<div class="td1">
																				<span class="require red"></span><span>课题分析：</span>
																			</div>
																			<div class="td2">
																				<span>
																					<textarea rows="5" cols="100" 
																					id="projectAnalysis"
																					name="projectAnalysis" th:text="${itemBank.projectAnalysis}"></textarea>
																				</span>
																			</div>
																		</div>
																	</td>
																</tr>
																
																
															</table>
															<div class="redbutton control-button JsW"
																data-control-type="button"
																data-control-config="{'buttonCls':'button'}">
																 <span class="grey"> <input value="取消"
																	type="button" class="radius5 button ks-pop-close1"
																	onclick="returnBack();" />
																</span> <span id="del"></span>
																<span> <input value="保存" type="button" onclick="sub()"
																	class="radius5 button ks-pop-close1" />
																</span>
															</div>
														</form>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- ============================= 页面内容 结束============================= -->
							</div>
						</div>
					</div>
				</div>
				<div th:include="commonTemplate :: leftMenus"></div>
			</div>
		</div>
		<div th:include="commonTemplate :: footer"></div>
	</div>
	<div th:include="commonTemplate :: processBar" />
	<script th:inline="javascript"> 
		$(function(){
			/*<![CDATA[*/
				var promptInformation=[[${promptInformation}]];
				var did = [[${itemBank.did}]];
				var itemlableSearch = [[${itemlableSearch}]];
				debugger;
				if(did != '' && did != null){
					$("#did").val(did);
				}
				if(promptInformation != '' && promptInformation != null){
					_alert(promptInformation);
				}
				if(itemlableSearch !='' && itemlableSearch != null){
					_alert(itemlableSearch);
				}
			/*]]>*/
		});
		
		
		
		function sub(){
			/*<![CDATA[*/
				var iId = $("#iId").val();
				var did = $("#did").val();
				var iId = $("#iId").val();
				var subject = $("#subject").val();
				if(did == null || did == ''){
					_alert("试题类型必选");
				}else if(subject =='' || subject == null){
					_alert("题目不能为空");
				}else if(subject.length>200 || subject.length<1){
					_alert("题目长度不能超过 200 低于 1");
				}else{
					$.ajax({
						url:[[@{/itemBank/judgeItemBank2.ht}]],
						data:{'subject':subject, 'iId':iId},
						type:"get",
						dataType:"json",
						success:function(obj){
							if(obj == false){
								_alert("题目已存在");
								$("#subject").val("");
							}else{
								var selectOne = $("#selectOne").val();
								var selectTwo = $("#selectTwo").val();
								var selectThree = $("#selectThree").val();
								var selectFour = $("#selectFour").val();
								var answer = $("#answer").val();
								var regular =  /^(?!.*((A.*){2,}|(B.*){2,}|(C.*){2,}|(D.*){2,})$)[A-D]{1,4}$/;
								if( selectOne.trim() == '' || selectOne.trim() == null){
									_alert("选择一必填");
								}else if(selectOne.length >200 || selectOne.length <1){
									_alert("选择一长度不能超过 200 低于 1");
								}else if( selectTwo.trim() == '' || selectTwo.trim() == null){
									_alert("选择二必填");
								}else if(selectTwo.length >200 || selectTwo.length <1){
									_alert("选择二长度不能超过 200 低于 1");
								}else if(selectThree.trim() == '' || selectThree.trim() == null){ // 选项三的分叉校验
									if(answer.trim() == '' && answer.trim() == null){
										_alert("答案不能为空!");
									}else if(!regular.test(answer)){
										_alert("试题答案输入错误!(只允许大写A,B,C,D)");
									}else if(answer.length != 1){
										_alert("答案格式输入错误!");
									}else if(answer != 'A' && answer != 'B'){
										_alert("答案输入错误!");
									}else{ // 校验试题是否被选中
										$.ajax({
											url:[[@{/itemBank/whetherToOccupyOrNot.ht}]],
											data:{'iId':iId},
											type:"get",
											dataType:"json",
											success:function(obj){
												if(obj == false){
													_alert("试题已经在使用,不能操作!");
												}else{// 提交表单
													$("#ClaForm").submit();
												}
											}
										});
										
									}
								}else if(selectFour.trim() == '' || selectFour.trim() == null){ // 选项四的分支校验
									if(answer.trim() == '' && answer.trim() == null){
										_alert("答案不能为空!");
									}else if(!regular.test(answer)){
										_alert("试题答案输入错误!(只允许大写A,B,C,D)");
									}else if(answer.length != 1){
										_alert("答案格式输入错误!");
									}else if(answer == 'D'){
										_alert("答案输入错误!");
									}else{
										$.ajax({
											url:[[@{/itemBank/whetherToOccupyOrNot.ht}]],
											data:{'iId':iId},
											type:"get",
											dataType:"json",
											success:function(obj){
												if(obj == false){
													_alert("试题已经在使用,不能操作!");
												}else{// 提交表单
													$("#ClaForm").submit();
												}
											}
										});
									}
								}else{ //正常校验
									if(answer.trim() == '' && answer.trim() == null){
										_alert("答案不能为空!");
									}else if(!regular.test(answer)){
										_alert("试题答案输入错误!(只允许大写A,B,C,D)");
									}else if(answer.length != 1){
										_alert("答案格式输入错误!");
									}else{
										$.ajax({
											url:[[@{/itemBank/whetherToOccupyOrNot.ht}]],
											data:{'iId':iId},
											type:"get",
											dataType:"json",
											success:function(obj){
												if(obj == false){
													_alert("试题已经在使用,不能操作!");
												}else{// 提交表单
													$("#ClaForm").submit();
												}
											}
										});
									}
								}
							}
						}
					});
				}
			/*]]>*/
		}
		
		// 点击取消跳转列表页面
		function returnBack(){
			var url = [[@{'/itemBank/itemBankList.ht'}]];
			locationHref(url);
		} 
		</script>
</body>
</html>